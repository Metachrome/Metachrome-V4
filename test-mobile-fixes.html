<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mobile Fixes - METACHROME</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1b3a;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #4F46E5;
            border-radius: 8px;
        }
        .test-button {
            background: #4F46E5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #3730a3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #2d2e5a;
            border-radius: 5px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
    </style>
</head>
<body>
    <h1>üîß METACHROME Mobile Fixes Test</h1>
    
    <div class="test-section">
        <h2>üì± Mobile Detection</h2>
        <p>Current screen width: <span id="screenWidth"></span>px</p>
        <p>Is mobile: <span id="isMobile"></span></p>
        <p>User agent: <span id="userAgent"></span></p>
    </div>

    <div class="test-section">
        <h2>üîÑ Verification Status Test</h2>
        <p><strong>Note:</strong> You need to be logged in to test verification refresh. Please login first at <a href="/" style="color: #4F46E5;">METACHROME main page</a></p>
        <button class="test-button" onclick="testVerificationRefresh()">Test Verification Refresh</button>
        <button class="test-button" onclick="clearLocalStorage()">Clear LocalStorage</button>
        <button class="test-button" onclick="checkUserData()">Check User Data</button>
        <button class="test-button" onclick="testLoginStatus()">Check Login Status</button>
        <div id="verificationResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>üìê Layout Spacing Test</h2>
        <button class="test-button" onclick="testLayoutSpacing()">Test Layout Spacing</button>
        <div id="layoutResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>üåê API Connection Test</h2>
        <button class="test-button" onclick="testAPIConnection()">Test API Health</button>
        <button class="test-button" onclick="testAuthEndpoint()">Test Auth Endpoint</button>
        <div id="apiResult" class="result"></div>
    </div>

    <script>
        // Update screen info
        function updateScreenInfo() {
            document.getElementById('screenWidth').textContent = window.innerWidth;
            document.getElementById('isMobile').textContent = window.innerWidth < 768 ? 'Yes' : 'No';
            document.getElementById('userAgent').textContent = navigator.userAgent.substring(0, 50) + '...';
        }

        // Test login status
        async function testLoginStatus() {
            const result = document.getElementById('verificationResult');
            result.innerHTML = '<div class="warning">Checking login status...</div>';

            try {
                const response = await fetch('/api/auth', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `
                        <div class="success">‚úÖ Login status check successful!</div>
                        <div>Authenticated: ${data.authenticated ? 'Yes' : 'No'}</div>
                        <div>User: ${data.user ? data.user.username : 'Not logged in'}</div>
                        <div>Verification: ${data.user ? data.user.verification_status : 'N/A'}</div>
                        <div>Ready for verification refresh: ${data.authenticated ? 'Yes' : 'No - Please login first'}</div>
                    `;
                } else if (response.status === 401) {
                    result.innerHTML = `
                        <div class="warning">‚ö†Ô∏è Not logged in (401)</div>
                        <div>Please login at <a href="/" style="color: #4F46E5;">METACHROME main page</a> first</div>
                        <div>Then return here to test verification refresh</div>
                    `;
                } else {
                    result.innerHTML = `<div class="error">‚ùå API call failed: ${response.status}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Test verification refresh functionality
        async function testVerificationRefresh() {
            const result = document.getElementById('verificationResult');
            result.innerHTML = '<div class="warning">Testing verification refresh...</div>';

            try {
                // First check if logged in
                const authCheck = await fetch('/api/auth', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (!authCheck.ok) {
                    result.innerHTML = `
                        <div class="error">‚ùå Not logged in - cannot test verification refresh</div>
                        <div>Please login at <a href="/" style="color: #4F46E5;">METACHROME main page</a> first</div>
                    `;
                    return;
                }

                // Clear localStorage (simulating the refresh)
                localStorage.removeItem('user');

                // Test API call again
                const response = await fetch('/api/auth', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `
                        <div class="success">‚úÖ Verification refresh test successful!</div>
                        <div>User: ${data.user ? data.user.username : 'Not logged in'}</div>
                        <div>Verification: ${data.user ? data.user.verification_status : 'N/A'}</div>
                        <div>LocalStorage cleared and data refetched successfully!</div>
                    `;
                } else {
                    result.innerHTML = `<div class="error">‚ùå API call failed: ${response.status}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Clear localStorage
        function clearLocalStorage() {
            localStorage.clear();
            document.getElementById('verificationResult').innerHTML = '<div class="success">‚úÖ LocalStorage cleared</div>';
        }

        // Check user data
        function checkUserData() {
            const userData = localStorage.getItem('user');
            const result = document.getElementById('verificationResult');
            
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    result.innerHTML = `
                        <div class="success">‚úÖ User data found in localStorage</div>
                        <div>Username: ${user.username}</div>
                        <div>Verification: ${user.verification_status}</div>
                    `;
                } catch (error) {
                    result.innerHTML = `<div class="error">‚ùå Invalid user data in localStorage</div>`;
                }
            } else {
                result.innerHTML = '<div class="warning">‚ö†Ô∏è No user data in localStorage</div>';
            }
        }

        // Test layout spacing
        function testLayoutSpacing() {
            const result = document.getElementById('layoutResult');
            const isMobile = window.innerWidth < 768;
            
            result.innerHTML = `
                <div class="success">‚úÖ Layout spacing test</div>
                <div>Screen width: ${window.innerWidth}px</div>
                <div>Is mobile: ${isMobile ? 'Yes' : 'No'}</div>
                <div>Expected bottom padding: ${isMobile ? '96px (pb-24)' : '48px (pb-12)'}</div>
                <div>Mobile nav height: 80px</div>
                <div>Recommended total spacing: ${isMobile ? '96px' : '48px'}</div>
            `;
        }

        // Test API connection
        async function testAPIConnection() {
            const result = document.getElementById('apiResult');
            result.innerHTML = '<div class="warning">Testing API connection...</div>';
            
            try {
                const response = await fetch('/api/health');
                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `
                        <div class="success">‚úÖ API connection successful!</div>
                        <div>Status: ${data.status}</div>
                        <div>Environment: ${data.environment}</div>
                    `;
                } else {
                    result.innerHTML = `<div class="error">‚ùå API connection failed: ${response.status}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Test auth endpoint
        async function testAuthEndpoint() {
            const result = document.getElementById('apiResult');
            result.innerHTML = '<div class="warning">Testing auth endpoint...</div>';

            try {
                const response = await fetch('/api/auth', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `
                        <div class="success">‚úÖ Auth endpoint working!</div>
                        <div>Authenticated: ${data.authenticated ? 'Yes' : 'No'}</div>
                        <div>User: ${data.user ? data.user.username : 'None'}</div>
                    `;
                } else if (response.status === 401) {
                    result.innerHTML = `
                        <div class="warning">‚ö†Ô∏è Auth endpoint working (401 = not logged in)</div>
                        <div>This is expected when not authenticated</div>
                        <div>Login at <a href="/" style="color: #4F46E5;">METACHROME main page</a> to test authenticated features</div>
                    `;
                } else {
                    result.innerHTML = `<div class="error">‚ùå Auth endpoint failed: ${response.status}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Initialize
        updateScreenInfo();
        window.addEventListener('resize', updateScreenInfo);
    </script>
</body>
</html>
