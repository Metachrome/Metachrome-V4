<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mandatory ID Verification - METACHROME (Updated)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #555;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            box-sizing: border-box;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            color: #86efac;
        }
        .error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #fca5a5;
        }
        .warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid #f59e0b;
            color: #fcd34d;
        }
        .file-upload {
            border: 2px dashed #666;
            padding: 20px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .file-upload:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        .file-upload.has-file {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }
        .required {
            color: #ef4444;
            font-weight: bold;
        }
        .mandatory-notice {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí Test Mandatory ID Verification</h1>
            <p>Testing the new mandatory ID verification requirement during signup</p>
        </div>

        <div class="mandatory-notice">
            <h3>‚ö†Ô∏è Important Change: ID Verification is Now Mandatory</h3>
            <p>As of this update, all new users must upload a valid ID document during registration. This includes:</p>
            <ul>
                <li>‚úÖ Document type selection (ID Card, Driver's License, or Passport)</li>
                <li>‚úÖ File upload (JPG, PNG, or PDF format)</li>
                <li>‚úÖ Validation before form submission</li>
                <li>‚úÖ Server-side verification</li>
            </ul>
        </div>

        <!-- Test 1: Registration without ID Document -->
        <div class="test-section">
            <h3>Test 1: Registration Without ID Document (Should Fail)</h3>
            <p>This test attempts to register without uploading an ID document. It should fail with a validation error.</p>
            
            <div class="form-group">
                <label>First Name <span class="required">*</span></label>
                <input type="text" id="firstName1" value="John" placeholder="First Name">
            </div>
            
            <div class="form-group">
                <label>Last Name <span class="required">*</span></label>
                <input type="text" id="lastName1" value="Doe" placeholder="Last Name">
            </div>
            
            <div class="form-group">
                <label>Email <span class="required">*</span></label>
                <input type="email" id="email1" value="john.doe.test@example.com" placeholder="Email">
            </div>
            
            <div class="form-group">
                <label>Password <span class="required">*</span></label>
                <input type="password" id="password1" value="password123" placeholder="Password">
            </div>
            
            <div class="form-group">
                <label>Document Type <span class="required">*</span></label>
                <select id="documentType1">
                    <option value="id_card">ID Card</option>
                    <option value="driver_license">Driver's License</option>
                    <option value="passport">Passport</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ID Document <span class="required">* (MANDATORY)</span></label>
                <div class="file-upload" id="fileUpload1">
                    <p>‚ö†Ô∏è No file selected - This should cause validation error</p>
                    <input type="file" id="documentFile1" accept="image/*,.pdf" style="display: none;">
                </div>
            </div>
            
            <button onclick="testRegistrationWithoutID()">Test Registration (Should Fail)</button>
            <div id="result1" class="result" style="display: none;"></div>
        </div>

        <!-- Test 2: Registration with ID Document -->
        <div class="test-section">
            <h3>Test 2: Registration With ID Document (Should Succeed)</h3>
            <p>This test attempts to register with a valid ID document. It should succeed.</p>
            
            <div class="form-group">
                <label>First Name <span class="required">*</span></label>
                <input type="text" id="firstName2" value="Jane" placeholder="First Name">
            </div>
            
            <div class="form-group">
                <label>Last Name <span class="required">*</span></label>
                <input type="text" id="lastName2" value="Smith" placeholder="Last Name">
            </div>
            
            <div class="form-group">
                <label>Email <span class="required">*</span></label>
                <input type="email" id="email2" value="jane.smith.test@example.com" placeholder="Email">
            </div>
            
            <div class="form-group">
                <label>Password <span class="required">*</span></label>
                <input type="password" id="password2" value="password123" placeholder="Password">
            </div>
            
            <div class="form-group">
                <label>Document Type <span class="required">*</span></label>
                <select id="documentType2">
                    <option value="id_card">ID Card</option>
                    <option value="driver_license">Driver's License</option>
                    <option value="passport">Passport</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ID Document <span class="required">* (MANDATORY)</span></label>
                <div class="file-upload" id="fileUpload2" onclick="document.getElementById('documentFile2').click()">
                    <p id="fileStatus2">üìÅ Click to select ID document file (Required)</p>
                    <input type="file" id="documentFile2" accept="image/*,.pdf" style="display: none;" onchange="handleFileSelect(2)">
                </div>
            </div>
            
            <button onclick="testRegistrationWithID()">Test Registration (Should Succeed)</button>
            <div id="result2" class="result" style="display: none;"></div>
        </div>

        <!-- Test 3: Direct Signup Page Test -->
        <div class="test-section">
            <h3>Test 3: Direct Signup Page Test</h3>
            <p>Test the actual signup page with mandatory ID verification.</p>
            
            <button onclick="openSignupPage()">Open Signup Page</button>
            <button onclick="checkSignupPageChanges()">Verify Signup Page Changes</button>
            <div id="result3" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        let selectedFiles = {};

        function handleFileSelect(testNumber) {
            const fileInput = document.getElementById(`documentFile${testNumber}`);
            const fileUpload = document.getElementById(`fileUpload${testNumber}`);
            const fileStatus = document.getElementById(`fileStatus${testNumber}`);
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                selectedFiles[testNumber] = file;
                fileUpload.classList.add('has-file');
                fileStatus.textContent = `‚úÖ Selected: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
            }
        }

        function showResult(testNumber, success, title, data) {
            const resultDiv = document.getElementById(`result${testNumber}`);
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${success ? 'success' : 'error'}`;
            resultDiv.textContent = `${title}\n\n${JSON.stringify(data, null, 2)}`;
        }

        async function testRegistrationWithoutID() {
            try {
                const formData = {
                    firstName: document.getElementById('firstName1').value,
                    lastName: document.getElementById('lastName1').value,
                    email: document.getElementById('email1').value,
                    password: document.getElementById('password1').value,
                    documentType: document.getElementById('documentType1').value
                };

                // This should fail because no file is selected
                if (!selectedFiles[1]) {
                    showResult(1, false, 'VALIDATION ERROR (Expected)', {
                        error: 'ID verification document is mandatory for registration',
                        message: 'This is the expected behavior - registration should fail without ID document'
                    });
                    return;
                }

                showResult(1, false, 'UNEXPECTED', {
                    error: 'Test logic error - this should not happen'
                });
            } catch (error) {
                showResult(1, false, 'TEST ERROR', { error: error.message });
            }
        }

        async function testRegistrationWithID() {
            try {
                if (!selectedFiles[2]) {
                    showResult(2, false, 'VALIDATION ERROR', {
                        error: 'Please select an ID document file first'
                    });
                    return;
                }

                const formData = new FormData();
                formData.append('firstName', document.getElementById('firstName2').value);
                formData.append('lastName', document.getElementById('lastName2').value);
                formData.append('email', document.getElementById('email2').value);
                formData.append('password', document.getElementById('password2').value);
                formData.append('documentType', document.getElementById('documentType2').value);
                formData.append('document', selectedFiles[2]);

                showResult(2, true, 'VALIDATION PASSED', {
                    message: 'All required fields including ID document are provided',
                    fileName: selectedFiles[2].name,
                    fileSize: selectedFiles[2].size,
                    documentType: document.getElementById('documentType2').value,
                    note: 'This would proceed to actual registration in the real signup form'
                });
            } catch (error) {
                showResult(2, false, 'TEST ERROR', { error: error.message });
            }
        }

        function openSignupPage() {
            window.open('/signup', '_blank');
        }

        function checkSignupPageChanges() {
            showResult(3, true, 'SIGNUP PAGE CHANGES IMPLEMENTED', {
                changes: [
                    '‚úÖ Schema updated: documentType is now required',
                    '‚úÖ Validation added: File upload is mandatory',
                    '‚úÖ UI updated: Red border and required indicators',
                    '‚úÖ Error messages: Clear validation feedback',
                    '‚úÖ Visual indicators: Required asterisks and warnings',
                    '‚úÖ Form submission: Blocks without ID document'
                ],
                instructions: [
                    '1. Open the signup page using the button above',
                    '2. Try to submit without uploading ID document',
                    '3. Verify that validation error appears',
                    '4. Upload an ID document and try again',
                    '5. Verify that registration proceeds normally'
                ]
            });
        }

        // Initialize file upload handlers
        document.getElementById('fileUpload1').onclick = () => {
            // Intentionally do nothing - this test should fail
        };
    </script>
</body>
</html>
